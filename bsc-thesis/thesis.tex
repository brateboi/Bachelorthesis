\documentclass[a4paper,twoside,openright,11pt]{report}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage[labelfont=bf,labelsep=period]{caption}
\usepackage{enumitem}
\usepackage{float}
\usepackage[margin=2.5cm]{geometry}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\usepackage{numbertabbing}    % This is a non-standard style.
\usepackage{times}
\usepackage{url}
\usepackage{xcolor}
\usepackage{xspace}
\usepackage{bm}

\floatstyle{ruled}
\newfloat{algo}{htbp}{algo}
\floatname{algo}{Algorithm}

% Fill in your data here.
\newcommand{\thesistitle}{3D Metric Fields}
\newcommand{\thesisauthor}{Florin Achermann}
\newcommand{\thesisauthororigin}{Bern, Switzerland}
\newcommand{\thesisleiter}{Prof.\ Christian Cachin}
\newcommand{\thesisasst}{Denis Kalmykov}
\newcommand{\thesisurl}{http://cgg.unibe.ch/}
\newcommand{\thesissubtitle}{A Novel Approach to a New Idea}
\newcommand{\thesisdate}{15. September 2023}

% bars for matrices
\newcommand*{\vertbar}{\rule[-1ex]{0.5pt}{2.5ex}}
\newcommand*{\horzbar}{\rule[.5ex]{2.5ex}{0.5pt}}

\newtheorem*{remark}{Remark}


\begin{document}

\pagenumbering{roman}

\begin{titlepage}  
  \thispagestyle{empty}

  \begin{center}  
    \begin{figure}[t]  
      \center{\includegraphics[scale=0.5]{UNI_Bern.png}}
      \vspace{1in}     
    \end{figure}
    
    {\bfseries\Huge \thesistitle \\[2mm]
      \Large \thesissubtitle}\\
    \vspace{1.5cm}

    {\bfseries\LARGE Bachelor Thesis}\\
    \vspace{1.5cm}
    
    {\Large \thesisauthor\\[2mm]
      from\\[2mm]
      \thesisauthororigin}\\
    \vspace{1.5cm}

    {\Large Faculty of Science, University of Bern}\\
    \vspace{1.5cm}

    {\Large \thesisdate}\\
    \vspace{1.5cm}

    \vspace*{\fill}
    {\Large
      \thesisleiter\\
      \thesisasst\\
      Computer Graphics Group\\
      Institute of Computer Science\\
      University of Bern, Switzerland\\}
  \end{center}
\end{titlepage}


\chapter*{\centering Abstract}
\begin{quote}\noindent
  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
  tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
  veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
  commodo consequat. Duis aute irure dolor in reprehenderit in voluptate
  velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
  occaecat cupidatat non proident, sunt in culpa qui officia deserunt
  mollit anim id est laborum.
\end{quote}

\cleardoublepage


\tableofcontents


\cleardoublepage

\pagenumbering{arabic}


\chapter{Introduction}
\label{ch:intro}

Every thesis should start with an introduction.  This thesis is written
in \LaTeX~\cite{DBLP:books/daglib/0023602}.

  
\chapter{Background}

This chapter sets the stage and introduces already existing material.

A frame F is a set of 6 vectors $\{\pm F_0, \pm F_1, \pm F_2 \}$.
We can represent such a frame F as a $3\times3$ matrix F, where the $i$th-column is $F_i$.
A frame field then maps to every point in 3D-space such a frame, i.e. $F: \mathbb{R}^3 \to \mathbb{R}^{3\times3}$.
Usually, we work on a 3-manifold $\mathcal{M}$ and a positively oriented frame field, i.e.
$F\vert_{\mathcal{M}}: \mathcal{M} \to \mathbb{R}^{3\times3}$, where $\det(F)>0$.
To allow for anisotropic, nonuniform meshes, we generalize orthonormality of frames to
$g$-orthonormal frames. Orthonormality is measured in some metric $g$, and a frame F satifisfies the condition
$\langle F_i, F_j \rangle _g = \delta_{ij}$.
Any frame field with $\det(F)>0$ naturally defines a metric $g= (FF^{\top})^{-1}$, where $F$ is $g$-orthonormal
$$F^{\top}gF = Id.$$
We can factor the frame field F into a symmetric part $g^{1/2}$ and a rotational part $R$
$$F = g^{-1/2}R$$
The symmetric part $g^{-1/2}$ keeps $F$ $g$-orthonormal
$$ \implies F^{\top}gF = (g^{-1/2}R)^{\top}gg^{-1/2}R)=R^{\top}g^{-1/2}gg^{-1/2}R =Id.$$
and $R$ represents a rotational field $R: \mathcal{M} \to SO(3)$.
The requirements for our frame field are:
\begin{itemize}
  \item Smoothness
  \item Integrability
  \item Metric consistency: $g = (FF^{\top})^{-1}$
\end{itemize}

A vector field $U$ is integrable, if and only if $\nabla \times U = 0$,
which means the vector field has vanishing curl everywhere.
We can express this more naturally with the language of differential forms:
The curl can be written as the exterior derivative $d$ of a one-form $\alpha$.
A one-form (more generally, a differential form) is closed, if $d\alpha = 0$.
Therefore, the local integrability can be expressed as the closedness of a one-form.
We want $F^{-1}$ (TODO: why $F^{-1}$) to be integrable.
To achieve local integrability for, it suffices to make $R$ locally integrable.
We can think of a rotation field $R$ as the composition of 3 vector fields
$$R = \begin{bmatrix}
  \vertbar & \vertbar & \vertbar \\
  R_1 & R_2 & R_3 \\
  \vertbar & \vertbar & \vertbar
\end{bmatrix}$$
where $R_i : \mathbb{R}^3 \to \mathbb{R}^3$ is a vector field.
We can therefore construct a vector-valued one-form, given $p=(x,y,z)^{\top}$ in Euclidean coordinates
$$\alpha \triangleq F^{-1}dp = R^{\top}g^{1/2}dp$$
where $dp = (dx,dy,dz)^{\top}$ is the common orthonormal one-form basis of $\Omega^1(\mathcal{M})$.
$$R \text{ locally integrable} \iff \bm{0} = d\alpha$$
Some reformulations yield:
\begin{align*}
  \bm{0} = d\alpha &= d(R^{\top}g^{1/2}dp)\overset{(1)}{=} dR^{\top} \wedge  (g^{1/2}dp) + R^{\top}d(g^{1/2}dp) \\
  &= R^{\top}(\omega \wedge (g^{1/2}dp)+ d(g^{1/2}dp))
\end{align*} where for (1), the Leibnitz Rule for the exterior derivative is applied,
and we define
$$\omega = RdR^{\top} \in \mathfrak{so}(3).$$
\begin{remark}
  $\omega$ is an antisymmetric matrix-valued one-form (every element is a one-form).
\end{remark}
\begin{proof}
  We differentiate the orthogonality condition of the rotation matrix $R$ (taking the derivative w.r.t. every element):
  \begin{align*}
    Id &= RR^{\top} \\
    d(Id) &= d(RR^{\top}) \\
    \bm{0} &= dRR^{\top} + RdR^{\top} \\
    \bm{0} &= (RdR^{\top})^{\top} + RdR^{\top} \\
    -(RdR^{\top})^{\top} &= RdR^{\top}
  \end{align*}
\end{proof}
Elements of the Lie algebra $\mathfrak{so}(3)$ can be thought as infinitesimal rotations and $\omega$ can be used
as a connection one-form. For our purposes, it suffices to know that elements are antisymmetric matrices.
To make $R$ locally integrable, we find $\omega$ such that the one-form $\alpha$ is closed ($d\alpha = 0$, curl-free),
then try to match the $\omega$ with $R$, which can be expressed as
$$\min_{R\in SO(3)} ||RdR^T - \omega ||^2.$$

\paragraph{Connection evaluation}
To find $\omega$, we use the above equation
$$ \bm{0} = R^{\top}(\omega \wedge (g^{1/2}dp)+ d(g^{1/2}dp)) \iff \bm{0} = \omega \wedge (g^{1/2}dp)+ d(g^{1/2}dp)$$
and reformulate into a linear system.
We represent the antisymmetric matrix-valued one-form $\omega$
$$\omega = \begin{bmatrix}
 0 & \omega_{12} & -\omega_{31} \\
 -\omega_{12} & 0 & \omega_{23} \\
 \omega_{31} & -\omega_{23} & 0
\end{bmatrix}$$
by $
\begin{bmatrix}
  \omega_{23} & \omega_{31} & \omega_{12}
\end{bmatrix} = 
\begin{bmatrix}
  dx & dy & dz
\end{bmatrix} W$. We write $W=\begin{bmatrix}
  W_1,W_2,W_3
\end{bmatrix}$, $W_i \in \mathbb{R}^3$. That is, $W$ is the matrix with the coefficients for the one-forms.
Recall, a one-form can be expressed as
$$
\omega_{ij}= (\omega^{ij})_1dx + (\omega^{ij})_2dy + (\omega^{ij})_3dz
$$
So e.g. $$\omega_{23} = \begin{bmatrix}
  dx & dy & dz
\end{bmatrix}W_1 = (\omega^{23})_1dx + (\omega^{23})_2dy + (\omega^{23})_3dz$$
We write $A = g^{1/2}= \begin{bmatrix}
  A^1, A^2, A^3
\end{bmatrix}$.
We use the equation $\bm{0} = \omega \wedge (g^{1/2}dp)+ d(g^{1/2}dp)$.
First part:
\begin{align*}
  \omega \wedge g^{1/2}dp &= 
  \begin{bmatrix}
    0 & \omega_{12} & -\omega_{31} \\
    -\omega_{12} & 0 & \omega_{23} \\
    \omega_{31} & -\omega_{23} & 0
   \end{bmatrix}
   \bigwedge \begin{bmatrix}
    A^1_1 & A^2_1 & A^3_1 \\ A^1_2 & A^2_2 & A^3_2 \\ A^1_3 & A^2_3 & A^3_3 
  \end{bmatrix}
  \begin{bmatrix}
    dx \\ dy \\ dz
  \end{bmatrix} \\
  &= \begin{bmatrix}
    +\omega_{12} \wedge (A^1_2dx + A^2_2dy + A^3_2dz) - \omega_{31} \wedge (A^1_3dx + A^2_3dy + A^3_3dz) \\
    -\omega_{12} \wedge (A^1_1dx + A^2_1dy + A^3_1dz) + \omega_{23} \wedge (A^1_3dx + A^2_3dy + A^3_3dz) \\
    +\omega_{31} \wedge (A^1_1dx + A^2_1dy + A^3_1dz) - \omega_{23} \wedge (A^1_2dx+ A^2_2dy + A^3_2dz)
  \end{bmatrix}
\end{align*}
It will get really messy if we calculate each component here, so let us calculate one component separately first:
\begin{align*}
  \omega_{ij} \wedge (A^1_kdx + A^2_kdy + A^3_kdz) &=
  ((\omega^{ij})_1dx + (\omega^{ij})_2dy + (\omega^{ij})_3dz) \wedge (A^1_kdx + A^2_kdy+A^3_kdz) \\
  &= (\omega^{ij})_1 A^2_k dx\wedge dy + (\omega^{ij})_1 A^3_k dx \wedge dz \\
  &+ (\omega^{ij})_2 A^1_k dy\wedge dx + (\omega^{ij})_2 A^3_k dy \wedge dz \\
  &+ (\omega^{ij})_3 A^1_k dz\wedge dx + (\omega^{ij})_3 A^2_k dz \wedge dy \\
  &= ((\omega^{ij})_1A^2_k - (\omega^{ij})_2A^1_k)dx \wedge dy \\
  &+ ((\omega^{ij})_2A^3_k - (\omega^{ij})_3A^2_k)dy \wedge dz \\
  &+ ((\omega^{ij})_3A^1_k - (\omega^{ij})_1A^3_k)dz \wedge dx
\end{align*}
where we use the fact that $dx \wedge dx = 0$ and $dx \wedge dy = -dy \wedge dx$.
We can clean up the above expression using the cross product:
\begin{align*}
  \begin{bmatrix}
    ((\omega^{ij})_2A^3_k - (\omega^{ij})_3A^2_k) \\
    ((\omega^{ij})_3A^1_k - (\omega^{ij})_1A^3_k) \\
    ((\omega^{ij})_1A^2_k - (\omega^{ij})_2A^1_k) 
  \end{bmatrix}^{\top}
  \begin{bmatrix}
    dy \wedge dz \\
    dz \wedge dx \\
    dx \wedge dy 
  \end{bmatrix} = 
  \begin{bmatrix}
    W_i \times A^k
  \end{bmatrix}^{\top}
  \begin{bmatrix}
    dy \wedge dz \\
    dz \wedge dx \\
    dx \wedge dy 
  \end{bmatrix}
\end{align*}
We use the fact that $\begin{bmatrix}
  A_1, A_2, A_3 
\end{bmatrix} = \begin{bmatrix}
  A^1, A^2, A^3
\end{bmatrix}$ because $A$ is symmetric, and $W_1$ corresponds to $\omega_{23}$, $W_2$ to $\omega_{31}$ and $W_3$ to $\omega_{12}$.
Second part:
\begin{align*}
  d(g^{1/2}dp)= d(Adp) = d\left(\begin{bmatrix}
    A^1_1 & A^2_1 & A^3_1 \\
    A^1_2 & A^2_2 & A^3_2 \\
    A^1_3 & A^2_3 & A^3_3
  \end{bmatrix}
  \begin{bmatrix}
    dx \\ dy \\ dz
  \end{bmatrix}
  \right)
\end{align*}
Again, we can do this separately for each row:
\begin{align*}
  & \hspace{1.35em} d(A^1_k dx + A^2_k dy + A^3_k dz) \\
  &= dA^1_k \wedge dx + dA^2_k \wedge dy + dA^3_k \wedge dz \\
  &= \frac{\partial A^1_k}{\partial x}dx \wedge dx + \frac{\partial A^1_k}{\partial y}dy \wedge dx + \frac{\partial A^1_k}{\partial z}dz \wedge dx \\
  &+ \frac{\partial A^2_k}{\partial x}dx \wedge dy + \frac{\partial A^2_k}{\partial y}dy \wedge dy + \frac{\partial A^2_k}{\partial z}dz \wedge dy \\
  &+ \frac{\partial A^3_k}{\partial x}dx \wedge dz + \frac{\partial A^3_k}{\partial y}dy \wedge dz + \frac{\partial A^3_k}{\partial z}dz \wedge dz \\
  &= \left( \frac{\partial A^3_k}{\partial y} - \frac{\partial A^2_k}{\partial z} \right) dy \wedge dz + \left( \frac{\partial A^1_k}{\partial z} - \frac{\partial A^3_k}{\partial x} \right) dz \wedge dx + \left( \frac{\partial A^2_k}{\partial x} - \frac{\partial A^1_k}{\partial y} \right) dx \wedge dy \\
  &= (\nabla \times A_k)^{\top} \begin{bmatrix}
    dy \wedge dz \\ dz \wedge dx \\ dx \wedge dy
  \end{bmatrix} 
\end{align*}
Finally, we can put everything together:
\begin{align*}
  & \hspace{1em}\bm{0} = \begin{bmatrix}
    (W_3 \times A^2 - W_2 \times A^3 + \nabla \times A^1)^{\top} \\
    (W_1 \times A^3 - W_3 \times A^1+ \nabla \times A^2)^{\top} \\
    (W_2 \times A^1 - W_1 \times A^2 + \nabla \times A^3)^{\top}
  \end{bmatrix}\begin{bmatrix}
    dy \wedge dz \\ dz \wedge dx \\ dx \wedge dy
  \end{bmatrix} \\
  & \iff 
  \begin{bmatrix}
    (W_2 \times A^3 - W_3 \times A^2)^{\top}  \\ 
    (W_3 \times A^1 - W_1 \times A^3)^{\top}  \\
    (W_1 \times A^2 - W_2 \times A^1)^{\top}
  \end{bmatrix}
  \begin{bmatrix}
    dy \wedge dz \\ dz \wedge dx \\ dx \wedge dy
  \end{bmatrix}
  =
  \begin{bmatrix}
    (\nabla \times A^1)^{\top} \\
    (\nabla \times A^2)^{\top} \\
    (\nabla \times A^3)^{\top} \\
  \end{bmatrix}
  \begin{bmatrix}
    dy \wedge dz \\ dz \wedge dx \\ dx \wedge dy
  \end{bmatrix}
\end{align*}
Take the curl to the other side and switch order on the left-hand side to cancel the $-1$.
\chapter{First main chapter}

There are no fixed rules for the organization of the main chapters in a
thesis.  They should describe the project and its results according to the
standard scientific approach in the field.

\paragraph{Software projects.}

For a software project, the report often has just three chapters:
\begin{enumerate}
\item Design;
\item Implementation;
\item Validation.
\end{enumerate}


\paragraph{Theoretical projects.}

A report for a theoretical project should correspond to the organization of
the material.


\chapter{Second main chapter}

Here is an example for how to specify an algorithm in pseudo-code.

% These macros are only used for the pseudo-code example.
\newcommand{\str}[1]{\textsc{#1}}
\newcommand{\var}[1]{\textit{#1}}
\newcommand{\op}[1]{\textsl{#1}}
\def \ifempty#1{\def\temp{#1} \ifx\temp\empty }
\newcommand{\msg}[2]{\ensuremath{\ifempty{#2} [\str{#1}] \else [\str{#1}, {#2}] \fi}}
\newcommand{\tup}[1]{\ensuremath{\langle #1 \rangle}}
\newcommand{\nil}{\ensuremath{\bot}}
\newcommand{\false}{\textsc{false}\xspace}
\newcommand{\true}{\textsc{true}\xspace}

\newcommand\lastts{\var{lastts}\xspace}
\newcommand\nextts{\var{nextts}\xspace}
\newcommand\trusted{\var{trusted}\xspace}
\newcommand\newepoch{\var{newepoch}\xspace}
\newcommand\leader{\var{leader}\xspace}
\newcommand\ts{\var{ts}\xspace}
\newcommand{\CK}{\ensuremath{\mathcal{K}}\xspace}
\newcommand{\CP}{\ensuremath{\mathcal{P}}\xspace}
\newcommand{\CQ}{\ensuremath{\mathcal{Q}}\xspace}


\begin{algo*}
  \vbox{
    \small
    \begin{numbertabbing}
      xxxx\=xxxx\=xxxx\=xxxx\=xxxx\=xxxx\=MMMMMMMMMMMMMMMMMMM\=\kill
      \textbf{State} \label{}\\
      \> \(\lastts \gets 0\): most recently started epoch \label{}\\
      \> \(\nextts \gets 0\): timestamp of the next epoch \label{}\\
      \> \(\newepoch \gets \msg{\nil}{}^n\): list of \str{newepoch} messages\label{}\\
      \\
      \textbf{upon event} \(\op{complain}(p_{\ell})\) \textbf{such that} \( p_{\ell} = \leader(\lastts)\)  \textbf{do} \label{}\\  
      \> \textbf{if} \(\nextts = \lastts\) \textbf{then}\label{}\\
      \> \> \(\nextts \gets \lastts + 1\) \label{}\\
      \> \> send message \(\msg{\str{newepoch}}{\nextts}\) to all \(p_j \in \mathcal{P}\) \label{}\\
      \\
      \textbf{upon} receiving a message
      \(\msg{\str{newepoch}}{\ts}\)  from $p_j$
      \textbf{such that}  \(\ts = \lastts + 1 \) \textbf{do} \label{}\\
      \> \(\newepoch[j] \gets \str{newepoch}\) \label{}\\
      \\
      \textbf{upon exists} \(\ts\) \textbf{such that} \(\{ p_j \in \CP |~\newepoch[j] = \ts \} \in \CK_i\) \textbf{and} \(\nextts = \lastts\) \textbf{do} \label{}\\
      \> \(\nextts \gets \lastts + 1\) \label{}\\
      \> send message \(\msg{\str{newepoch}}{\nextts}\) to all \(p_j \in \CP\) \label{}\\
      \\
      \textbf{upon exists} \(\ts\) \textbf{such that} \(\{ p_j \in \CP |~\newepoch[j] = \ts \} \in \CQ_i\) \textbf{and} \(\nextts > \lastts\) \textbf{do} \label{}\\
      \> \(\lastts \gets \nextts\) \label{}\\
      \> \(\newepoch \gets [\nil]^n\)\label{}\\
      \> \textbf{output} \(\op{startepoch}(\lastts, \leader(\lastts))\) \label{}
    \end{numbertabbing}
  }
  \caption{Byzantine Leader-Based Epoch-Change (process $p_i$).}
  \label{alg:epoch-change}
\end{algo*}


\chapter{Conclusion}
\label{ch:conclusion}

The conclusion looks back at the entire work, gives a critical look,
summarizes, and discusses extensions and future work.


\appendix
\chapter{Extra material}
\label{app:extra}

Extra material may be placed in an appendix that appears after the conclusion.


% The bibliography appears after any appendix.

% Remove this again once you understand how BiBTex citations work.
\nocite{*}

% Using BibTeX is required.
\bibliography{thesis}

% BibTeX entries are found in bibliography databases, here the file
% `thesis.bib`.  There is ample documentation available on the web on
% BibTeX.  Make sure that each entry is self-contained and that all entries
% are consistent.  This means, for instance, that an entry of type
% `article` contains all required fields (author, title, journal, year,
% volume) and some optional fields (number, pages, month, doi, note, key).
% The database is consistent when every entry of type `article` contains
% the same mandatory and optional fields.
%
% It is particularly easy to copy&paste BibTeX entries from DBLP, an online
% bibliography of computer science (https://dblp.org):
% (1) Find the author page (like https://dblp.org/pid/l/LeslieLamport.html);
% (2) navigate to the work to be cited ([b2]);
% (3) move the mouse over the vertical arrow and select
% "export record > BibTeX";
% (4) copy the record into your .bib file.
%
% If you want a DOI or URL to be shown with the standard bibstyles, then 
% change every field like
%   url       = {https://doi.org/10.1007/978-3-642-15260-3},
% to this
%   note      = {\url{https://doi.org/10.1007/978-3-642-15260-3}}
% .

% Any bibstyle is fine, this one give particularly compact output.
% This is a non-standard style.
\bibliographystyle{ieeesort}


% Mandatory declaration of origin, this must be the last page.
\chapter*{Erklärung}

\emph{Erklärung gemäss Art.~30 RSL Phil.-nat. 18}

\vspace*{1cm}

\noindent
Ich erkläre hiermit, dass ich diese Arbeit selbstständig verfasst und keine
anderen als die angegebenen Quellen benutzt habe. Alle Stellen, die
wörtlich oder sinngemäss aus Quellen entnommen wurden, habe ich als solche
gekennzeichnet. Mir ist bekannt, dass andernfalls der Senat gemäss Artikel
36 Absatz 1 Buchstabe r des Gesetzes vom 5. September 1996 über die
Universität zum Entzug des auf Grund dieser Arbeit verliehenen Titels
berechtigt ist.

\vspace*{1cm}

\noindent
Für die Zwecke der Begutachtung und der Überprüfung der Einhaltung der
Selbständigkeitserklärung bzw.  der Reglemente betreffend Plagiate erteile
ich der Universität Bern das Recht, die dazu erforderlichen Personendaten
zu bearbeiten und Nutzungshandlungen vorzunehmen, insbesondere die
schriftliche Arbeit zu vervielfältigen und dauerhaft in einer Datenbank zu
speichern sowie diese zur Überprüfung von Arbeiten Dritter zu verwenden
oder hierzu zur Verfügung zu stellen.

\vspace*{5cm}

\par\noindent\makebox[6cm]{\hrulefill}   \hfill\makebox[8cm]{\hrulefill}
\par\noindent\makebox[6cm][l]{Ort/Datum} \hfill\makebox[8cm][l]{Unterschrift}

\end{document}
